<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obsidian Encounter Processor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1d1e20; /* Adjusted background color */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .description-box {
            background-color: #2e2e33; /* Adjusted box color */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
            text-align: center;
            color: #d1d5db; /* Adjusted text color for better contrast */
            font-size: 1rem;
            line-height: 1.5;
        }
        .description-box a { /* Added style for links within description box */
            color: #60a5fa; /* Blue color for the link */
            text-decoration: underline;
        }
        .description-box a:hover {
            color: #3b82f6; /* Darker blue on hover */
        }
        .container {
            background-color: #2e2e33; /* Adjusted box color */
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #4b5563; /* Adjusted border color for dark theme */
            border-radius: 8px;
            font-size: 1rem;
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
            background-color: #46464a; /* Adjusted textarea background to #46464a */
            color: #f9fafb; /* Adjusted textarea text color */
        }
        button {
            background-color: #e05a0b; /* Default button color (previously hover color) */
            color: white; /* Explicitly set to white */
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: none; /* Removed shadow */
        }
        button:hover {
            background-color: #c94f0a; /* Darker hover color */
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
            box-shadow: none; /* Ensure no shadow on active state either */
        }
        h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #f9fafb; /* Adjusted heading color for better contrast */
            text-align: center;
        }
        label {
            font-weight: 600;
            color: #d1d5db; /* Adjusted label color for better contrast */
            margin-bottom: 8px;
            display: block;
        }
        .output-container {
            background-color: #46464a; /* Adjusted output container background to #46464a */
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 100px;
            color: #f9fafb; /* Adjusted output text color */
            border: 1px solid #6b7280; /* Adjusted border color */
        }
        .error-message {
            color: #ef4444; /* Adjusted error message color for dark theme */
            font-weight: 600;
            text-align: center;
        }
        .copy-feedback {
            margin-top: 8px;
            font-size: 0.9rem;
            color: #34d399; /* Adjusted green color for success */
            text-align: center;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .copy-feedback.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="description-box">
        <p>
            This program hardcodes HP and AC values into encounter stat blocks generated in the
            <a href="https://obsidianttrpgtutorials.com/Obsidian+TTRPG+Tutorials/Plugin+Tutorials/Initiative+Tracker" target="_blank" rel="noopener noreferrer">initiative tracker plugin</a>
            for Obsidian. This is intended for use with the mobile
            version of Obsidian as non hard coded stats for creatures appear as 0 on the Android
            build (in my experience).
        </p>
    </div>
    <div class="container">
        <h1>Obsidian Encounter Block Processor</h1>

        <div class="input-section">
            <label for="inputEncounter">Paste your encounter block here:</label>
            <textarea id="inputEncounter" placeholder="```encounter
name: My Dungeon Encounter
creatures:
  - '2': Zombie
  - '1': Mimic
  - '3': Goblin
```"></textarea>
        </div>

        <button id="processButton" class="text-white">Process Encounter</button>

        <div class="output-section">
            <label for="outputEncounter">Processed Encounter Block:</label>
            <textarea id="outputEncounter" readonly></textarea>
            <button id="copyButton" class="mt-4 text-white">Copy to Clipboard</button>
            <div id="copyFeedback" class="copy-feedback"></div>
            <div id="errorMessage" class="error-message mt-2 hidden"></div>
        </div>
    </div>

    <script>
        // XML content provided by the user
        const dndCreaturesXML = `<?xml version="1.0" encoding="UTF-8"?>
<Monsters>
  <Monster>
    <Name>Aboleth</Name>
    <AverageHP>135</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Acolyte</Name>
    <AverageHP>9</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Adult Black Dragon</Name>
    <AverageHP>195</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Adult Blue Dragon</Name>
    <AverageHP>225</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Adult Brass Dragon</Name>
    <AverageHP>172</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Adult Bronze Dragon</Name>
    <AverageHP>212</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Adult Copper Dragon</Name>
    <AverageHP>184</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Adult Gold Dragon</Name>
    <AverageHP>256</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Adult Green Dragon</Name>
    <AverageHP>207</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Adult Red Dragon</Name>
    <AverageHP>256</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Adult Silver Dragon</Name>
    <AverageHP>243</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Adult White Dragon</Name>
    <AverageHP>200</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Air Elemental</Name>
    <AverageHP>90</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Ancient Black Dragon</Name>
    <AverageHP>367</AverageHP>
    <AC>22</AC>
  </Monster>
  <Monster>
    <Name>Ancient Blue Dragon</Name>
    <AverageHP>481</AverageHP>
    <AC>22</AC>
  </Monster>
  <Monster>
    <Name>Ancient Brass Dragon</Name>
    <AverageHP>297</AverageHP>
    <AC>20</AC>
  </Monster>
  <Monster>
    <Name>Ancient Bronze Dragon</Name>
    <AverageHP>444</AverageHP>
    <AC>22</AC>
  </Monster>
  <Monster>
    <Name>Ancient Copper Dragon</Name>
    <AverageHP>350</AverageHP>
    <AC>21</AC>
  </Monster>
  <Monster>
    <Name>Ancient Gold Dragon</Name>
    <AverageHP>546</AverageHP>
    <AC>22</AC>
  </Monster>
  <Monster>
    <Name>Ancient Green Dragon</Name>
    <AverageHP>385</AverageHP>
    <AC>21</AC>
  </Monster>
  <Monster>
    <Name>Ancient Red Dragon</Name>
    <AverageHP>546</AverageHP>
    <AC>22</AC>
  </Monster>
  <Monster>
    <Name>Ancient Silver Dragon</Name>
    <AverageHP>487</AverageHP>
    <AC>22</AC>
  </Monster>
  <Monster>
    <Name>Ancient White Dragon</Name>
    <AverageHP>333</AverageHP>
    <AC>20</AC>
  </Monster>
  <Monster>
    <Name>Androsphinx</Name>
    <AverageHP>199</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Animated Armor</Name>
    <AverageHP>33</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Ankheg</Name>
    <AverageHP>39</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Ape</Name>
    <AverageHP>19</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Archmage</Name>
    <AverageHP>99</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Assassin</Name>
    <AverageHP>78</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Awakened Shrub</Name>
    <AverageHP>10</AverageHP>
    <AC>9</AC>
  </Monster>
  <Monster>
    <Name>Awakened Tree</Name>
    <AverageHP>59</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Axe Beak</Name>
    <AverageHP>19</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Azer</Name>
    <AverageHP>39</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Baboon</Name>
    <AverageHP>3</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Badger</Name>
    <AverageHP>3</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Balor</Name>
    <AverageHP>262</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Bandit</Name>
    <AverageHP>11</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Bandit Captain</Name>
    <AverageHP>65</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Banshee</Name>
    <AverageHP>58</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Barbed Devil</Name>
    <AverageHP>110</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Basilisk</Name>
    <AverageHP>52</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Bat</Name>
    <AverageHP>1</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Bearded Devil</Name>
    <AverageHP>52</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Behir</Name>
    <AverageHP>168</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Beholder</Name>
    <AverageHP>180</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Beholder Zombie</Name>
    <AverageHP>93</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Berserker</Name>
    <AverageHP>67</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Black Pudding</Name>
    <AverageHP>85</AverageHP>
    <AC>7</AC>
  </Monster>
  <Monster>
    <Name>Blink Dog</Name>
    <AverageHP>22</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Boar</Name>
    <AverageHP>11</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Bone Devil</Name>
    <AverageHP>142</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Bugbear</Name>
    <AverageHP>27</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Bulette</Name>
    <AverageHP>94</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Camel</Name>
    <AverageHP>15</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Carrion Crawler</Name>
    <AverageHP>51</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Cat</Name>
    <AverageHP>2</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Centaur</Name>
    <AverageHP>45</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Chain Devil</Name>
    <AverageHP>85</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Chimera</Name>
    <AverageHP>114</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Chuul</Name>
    <AverageHP>93</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Clay Golem</Name>
    <AverageHP>133</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Cloaker</Name>
    <AverageHP>78</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Cloud Giant</Name>
    <AverageHP>200</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Cockatrice</Name>
    <AverageHP>33</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Commoner</Name>
    <AverageHP>4</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Couatl</Name>
    <AverageHP>97</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Crab</Name>
    <AverageHP>2</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Crocodile</Name>
    <AverageHP>19</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Cult Fanatic</Name>
    <AverageHP>33</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Cultist</Name>
    <AverageHP>9</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Darkmantle</Name>
    <AverageHP>22</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Death Dog</Name>
    <AverageHP>39</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Deva</Name>
    <AverageHP>136</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Dire Wolf</Name>
    <AverageHP>37</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Djinni</Name>
    <AverageHP>117</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Doppelganger</Name>
    <AverageHP>52</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Draft Horse</Name>
    <AverageHP>19</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Dragon Turtle</Name>
    <AverageHP>341</AverageHP>
    <AC>20</AC>
  </Monster>
  <Monster>
    <Name>Dretch</Name>
    <AverageHP>18</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Drider</Name>
    <AverageHP>75</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Drow</Name>
    <AverageHP>13</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Druid</Name>
    <AverageHP>27</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Dryad</Name>
    <AverageHP>21</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Duergar</Name>
    <AverageHP>26</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Eagle</Name>
    <AverageHP>3</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Earth Elemental</Name>
    <AverageHP>126</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Efreeti</Name>
    <AverageHP>200</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Elephant</Name>
    <AverageHP>76</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Elk</Name>
    <AverageHP>13</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Erinyes</Name>
    <AverageHP>153</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Ettercap</Name>
    <AverageHP>44</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Ettin</Name>
    <AverageHP>85</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Fire Elemental</Name>
    <AverageHP>102</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Fire Giant</Name>
    <AverageHP>162</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Flesh Golem</Name>
    <AverageHP>93</AverageHP>
    <AC>9</AC>
  </Monster>
  <Monster>
    <Name>Flying Snake</Name>
    <AverageHP>4</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Flying Sword</Name>
    <AverageHP>17</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Frog</Name>
    <AverageHP>1</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Frost Giant</Name>
    <AverageHP>138</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Gargoyle</Name>
    <AverageHP>52</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Gelatinous Cube</Name>
    <AverageHP>84</AverageHP>
    <AC>6</AC>
  </Monster>
  <Monster>
    <Name>Ghast</Name>
    <AverageHP>36</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Ghost</Name>
    <AverageHP>45</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Ghoul</Name>
    <AverageHP>22</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Giant Ape</Name>
    <AverageHP>157</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Giant Badger</Name>
    <AverageHP>13</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Giant Bat</Name>
    <AverageHP>22</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Giant Boar</Name>
    <AverageHP>42</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Giant Centipede</Name>
    <AverageHP>4</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Giant Constrictor Snake</Name>
    <AverageHP>60</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Giant Crab</Name>
    <AverageHP>13</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Giant Crocodile</Name>
    <AverageHP>85</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Giant Eagle</Name>
    <AverageHP>26</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Giant Elk</Name>
    <AverageHP>42</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Giant Fire Beetle</Name>
    <AverageHP>4</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Giant Frog</Name>
    <AverageHP>18</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Giant Hyena</Name>
    <AverageHP>45</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Giant Lizard</Name>
    <AverageHP>19</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Giant Octopus</Name>
    <AverageHP>52</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Giant Owl</Name>
    <AverageHP>19</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Giant Poisonous Snake</Name>
    <AverageHP>11</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Giant Rat</Name>
    <AverageHP>7</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Giant Scorpion</Name>
    <AverageHP>52</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Giant Sea Horse</Name>
    <AverageHP>19</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Giant Spider</Name>
    <AverageHP>26</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Giant Toad</Name>
    <AverageHP>39</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Giant Vulture</Name>
    <AverageHP>22</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Giant Wasp</Name>
    <AverageHP>13</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Giant Weasel</Name>
    <AverageHP>9</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Giant Wolf Spider</Name>
    <AverageHP>7</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Gibbering Mouther</Name>
    <AverageHP>67</AverageHP>
    <AC>9</AC>
  </Monster>
  <Monster>
    <Name>Glabrezu</Name>
    <AverageHP>157</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Gargantuan Red Dragon</Name>
    <AverageHP>546</AverageHP>
    <AC>22</AC>
  </Monster>
  <Monster>
    <Name>Gargantuan Silver Dragon</Name>
    <AverageHP>487</AverageHP>
    <AC>22</AC>
  </Monster>
  <Monster>
    <Name>Gargantuan White Dragon</Name>
    <AverageHP>333</AverageHP>
    <AC>20</AC>
  </Monster>
  <Monster>
    <Name>Gladiator</Name>
    <AverageHP>112</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Gnoll</Name>
    <AverageHP>22</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Goat</Name>
    <AverageHP>4</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Goblin</Name>
    <AverageHP>7</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Goblin Boss</Name>
    <AverageHP>21</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Gorgon</Name>
    <AverageHP>114</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Gray Ooze</Name>
    <AverageHP>22</AverageHP>
    <AC>8</AC>
  </Monster>
  <Monster>
    <Name>Green Hag</Name>
    <AverageHP>82</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Grick</Name>
    <AverageHP>27</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Griffon</Name>
    <AverageHP>59</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Grimlock</Name>
    <AverageHP>11</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Guard</Name>
    <AverageHP>11</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Guardian Naga</Name>
    <AverageHP>127</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Half-Red Dragon Veteran</Name>
    <AverageHP>65</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Harpy</Name>
    <AverageHP>38</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Hell Hound</Name>
    <AverageHP>45</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Hezrou</Name>
    <AverageHP>102</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Hill Giant</Name>
    <AverageHP>105</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Hippogriff</Name>
    <AverageHP>33</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Hobgoblin</Name>
    <AverageHP>11</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Homunculus</Name>
    <AverageHP>5</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Horned Devil</Name>
    <AverageHP>178</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Hunter Shark</Name>
    <AverageHP>45</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Hydra</Name>
    <AverageHP>172</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Hyena</Name>
    <AverageHP>5</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Ice Devil</Name>
    <AverageHP>180</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Imp</Name>
    <AverageHP>10</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Invisible Stalker</Name>
    <AverageHP>104</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Iron Golem</Name>
    <AverageHP>210</AverageHP>
    <AC>20</AC>
  </Monster>
  <Monster>
    <Name>Jackal</Name>
    <AverageHP>3</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Killer Whale</Name>
    <AverageHP>90</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Knight</Name>
    <AverageHP>52</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Kobold</Name>
    <AverageHP>5</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Kraken</Name>
    <AverageHP>472</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Lamia</Name>
    <AverageHP>97</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Lemure</Name>
    <AverageHP>13</AverageHP>
    <AC>7</AC>
  </Monster>
  <Monster>
    <Name>Lich</Name>
    <AverageHP>135</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Lion</Name>
    <AverageHP>26</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Lizard</Name>
    <AverageHP>2</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Lizardfolk</Name>
    <AverageHP>22</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Mage</Name>
    <AverageHP>40</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Magmin</Name>
    <AverageHP>9</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Manticore</Name>
    <AverageHP>68</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Marilith</Name>
    <AverageHP>189</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Mastiff</Name>
    <AverageHP>5</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Medusa</Name>
    <AverageHP>127</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Merfolk</Name>
    <AverageHP>11</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Merrow</Name>
    <AverageHP>45</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Mimic</Name>
    <AverageHP>58</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Minotaur</Name>
    <AverageHP>76</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Minotaur Skeleton</Name>
    <AverageHP>67</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Mule</Name>
    <AverageHP>11</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Mummy</Name>
    <AverageHP>58</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Mummy Lord</Name>
    <AverageHP>117</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Nalfeshnee</Name>
    <AverageHP>184</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Night Hag</Name>
    <AverageHP>112</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Nightmare</Name>
    <AverageHP>66</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Noble</Name>
    <AverageHP>9</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Ochre Jelly</Name>
    <AverageHP>45</AverageHP>
    <AC>8</AC>
  </Monster>
  <Monster>
    <Name>Octopus</Name>
    <AverageHP>3</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Ogre</Name>
    <AverageHP>59</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Ogre Zombie</Name>
    <AverageHP>66</AverageHP>
    <AC>8</AC>
  </Monster>
  <Monster>
    <Name>Oni</Name>
    <AverageHP>110</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Orc</Name>
    <AverageHP>15</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Otyugh</Name>
    <AverageHP>114</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Owl</Name>
    <AverageHP>1</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Owlbear</Name>
    <AverageHP>91</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Panther</Name>
    <AverageHP>13</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Pegasus</Name>
    <AverageHP>59</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Phase Spider</Name>
    <AverageHP>32</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Pit Fiend</Name>
    <AverageHP>300</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Planetar</Name>
    <AverageHP>200</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Plesiosaurus</Name>
    <AverageHP>68</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Poisonous Snake</Name>
    <AverageHP>2</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Polar Bear</Name>
    <AverageHP>42</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Pony</Name>
    <AverageHP>10</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Priest</Name>
    <AverageHP>27</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Pseudodragon</Name>
    <AverageHP>7</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Purple Worm</Name>
    <AverageHP>247</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Quasit</Name>
    <AverageHP>7</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Rakshasa</Name>
    <AverageHP>110</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Rat</Name>
    <AverageHP>1</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Raven</Name>
    <AverageHP>1</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Rhinoceros</Name>
    <AverageHP>45</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Riding Horse</Name>
    <AverageHP>13</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Roc</Name>
    <AverageHP>248</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Roper</Name>
    <AverageHP>93</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Rug of Smothering</Name>
    <AverageHP>33</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Rust Monster</Name>
    <AverageHP>27</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Saber-Toothed Tiger</Name>
    <AverageHP>52</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Sahuagin</Name>
    <AverageHP>22</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Salamander</Name>
    <AverageHP>90</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Satyr</Name>
    <AverageHP>31</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Scorpion</Name>
    <AverageHP>1</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Scout</Name>
    <AverageHP>16</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Sea Hag</Name>
    <AverageHP>52</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Sea Horse</Name>
    <AverageHP>1</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Shadow</Name>
    <AverageHP>16</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Shambling Mound</Name>
    <AverageHP>136</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Shield Guardian</Name>
    <AverageHP>142</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Shrieker</Name>
    <AverageHP>13</AverageHP>
    <AC>5</AC>
  </Monster>
  <Monster>
    <Name>Skeleton</Name>
    <AverageHP>13</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Solar</Name>
    <AverageHP>243</AverageHP>
    <AC>21</AC>
  </Monster>
  <Monster>
    <Name>Specter</Name>
    <AverageHP>22</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Spider</Name>
    <AverageHP>1</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Spirit Naga</Name>
    <AverageHP>75</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Sprite</Name>
    <AverageHP>2</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Steam Mephit</Name>
    <AverageHP>21</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Stirge</Name>
    <AverageHP>2</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Stone Giant</Name>
    <AverageHP>126</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Stone Golem</Name>
    <AverageHP>178</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Storm Giant</Name>
    <AverageHP>230</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Succubus/Incubus</Name>
    <AverageHP>66</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Bats</Name>
    <AverageHP>22</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Centipedes</Name>
    <AverageHP>33</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Insects</Name>
    <AverageHP>22</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Poisonous Snakes</Name>
    <AverageHP>33</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Quippers</Name>
    <AverageHP>28</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Rats</Name>
    <AverageHP>24</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Ravens</Name>
    <AverageHP>24</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Spiders</Name>
    <AverageHP>22</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Swarm of Wasps</Name>
    <AverageHP>22</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Tarrasque</Name>
    <AverageHP>676</AverageHP>
    <AC>25</AC>
  </Monster>
  <Monster>
    <Name>Thug</Name>
    <AverageHP>32</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Tiger</Name>
    <AverageHP>33</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Treant</Name>
    <AverageHP>138</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Tribal Warrior</Name>
    <AverageHP>11</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Triceratops</Name>
    <AverageHP>121</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Troll</Name>
    <AverageHP>84</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Tyrannosaurus Rex</Name>
    <AverageHP>136</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Unicorn</Name>
    <AverageHP>67</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Vampire</Name>
    <AverageHP>144</AverageHP>
    <AC>16</AC>
  </Monster>
  <Monster>
    <Name>Vampire Spawn</Name>
    <AverageHP>82</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Veteran</Name>
    <AverageHP>58</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Violet Fungus</Name>
    <AverageHP>18</AverageHP>
    <AC>5</AC>
  </Monster>
  <Monster>
    <Name>Vrock</Name>
    <AverageHP>104</AverageHP>
    <AC>15</AC>
  </Monster>
  <Monster>
    <Name>Vulture</Name>
    <AverageHP>5</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Warhorse</Name>
    <AverageHP>19</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Warhorse Skeleton</Name>
    <AverageHP>22</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Water Elemental</Name>
    <AverageHP>114</AverageHP>
    <AC>14</AC>
  </Monster>
  <Monster>
    <Name>Weasel</Name>
    <AverageHP>1</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Werebear</Name>
    <AverageHP>135</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Wereboar</Name>
    <AverageHP>78</AverageHP>
    <AC>11</AC>
  </Monster>
  <Monster>
    <Name>Wererat</Name>
    <AverageHP>33</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Weretiger</Name>
    <AverageHP>120</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Werewolf</Name>
    <AverageHP>58</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Wight</Name>
    <AverageHP>45</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Will-o'-Wisp</Name>
    <AverageHP>22</AverageHP>
    <AC>10</AC>
  </Monster>
  <Monster>
    <Name>Winter Wolf</Name>
    <AverageHP>75</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Wolf</Name>
    <AverageHP>11</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Worg</Name>
    <AverageHP>26</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Wraith</Name>
    <AverageHP>67</AverageHP>
    <AC>12</AC>
  </Monster>
  <Monster>
    <Name>Wyvern</Name>
    <AverageHP>110</AverageHP>
    <AC>13</AC>
  </Monster>
  <Monster>
    <Name>Xorn</Name>
    <AverageHP>73</AverageHP>
    <AC>19</AC>
  </Monster>
  <Monster>
    <Name>Young Black Dragon</Name>
    <AverageHP>127</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Young Blue Dragon</Name>
    <AverageHP>152</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Young Brass Dragon</Name>
    <AverageHP>110</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Young Bronze Dragon</Name>
    <AverageHP>142</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Young Copper Dragon</Name>
    <AverageHP>119</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Young Gold Dragon</Name>
    <AverageHP>178</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Young Green Dragon</Name>
    <AverageHP>136</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Young Red Dragon</Name>
    <AverageHP>178</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Young Silver Dragon</Name>
    <AverageHP>168</AverageHP>
    <AC>18</AC>
  </Monster>
  <Monster>
    <Name>Young White Dragon</Name>
    <AverageHP>133</AverageHP>
    <AC>17</AC>
  </Monster>
  <Monster>
    <Name>Zombie</Name>
    <AverageHP>22</AverageHP>
    <AC>8</AC>
  </Monster>
</Monsters>`;

        let monsterData = {}; // To store parsed monster data for quick lookup

        /**
         * Parses the XML string into a JavaScript object for easy lookup.
         * Stores monster name as key and an object {hp, ac} as value.
         */
        function parseMonsterXML() {
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(dndCreaturesXML, "text/xml");
                const monsters = xmlDoc.getElementsByTagName("Monster");

                for (let i = 0; i < monsters.length; i++) {
                    const name = monsters[i].getElementsByTagName("Name")[0].textContent;
                    const hp = monsters[i].getElementsByTagName("AverageHP")[0].textContent;
                    const ac = monsters[i].getElementsByTagName("AC")[0].textContent;
                    monsterData[name] = { hp: hp, ac: ac };
                }
                console.log("Monster data loaded:", monsterData);
            } catch (e) {
                console.error("Error parsing XML:", e);
                displayError("Failed to load monster data from XML. Please check the XML format.");
            }
        }

        /**
         * Processes the input encounter block to add HP and AC.
         * @param {string} inputBlock The raw encounter block string.
         * @returns {string} The processed encounter block string or an error message.
         */
        function processEncounterBlock(inputBlock) {
            const lines = inputBlock.split('\n');
            let outputLines = [];
            let inCreaturesSection = false;
            let errors = [];

            // Regex to find the start and end of the encounter block
            const blockStartRegex = /```encounter/;
            const blockEndRegex = /```/;
            // Regex to parse creature lines: - "QUANTITY": NAME, [HP, AC]
            const creatureLineRegex = /^\s*-\s*"(?<quantity>\d+)":\s*(?<name>[^,]+)(?:,\s*\d+\s*,\s*\d+)?\s*$/;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i]; // Keep original line to preserve indentation

                if (blockStartRegex.test(line.trim())) {
                    outputLines.push(line); // Add the ```encounter line
                    inCreaturesSection = true;
                    continue;
                }

                if (blockEndRegex.test(line.trim()) && inCreaturesSection) {
                    inCreaturesSection = false;
                    outputLines.push(line); // Add the closing ``` line
                    continue;
                }

                if (inCreaturesSection) {
                    // Check for 'name:' or 'creatures:' lines and keep them as is
                    if (line.trim().startsWith('name:') || line.trim().startsWith('creatures:')) {
                        outputLines.push(line);
                        continue;
                    }

                    const match = line.trim().match(creatureLineRegex);
                    if (match) {
                        const quantity = match.groups.quantity;
                        const creatureName = match.groups.name.trim(); // Trim to remove any leading/trailing spaces

                        if (monsterData[creatureName]) {
                            const { hp, ac } = monsterData[creatureName];
                            // Reconstruct the line with correct indentation and HP/AC
                            const indentation = line.match(/^\s*/)?.[0] || ''; // Capture leading whitespace
                            outputLines.push(`${indentation}- "${quantity}": ${creatureName}, ${hp}, ${ac}`);
                        } else {
                            errors.push(`Warning: Stats not found for "${creatureName}". Keeping original line.`);
                            outputLines.push(line); // Keep original line if not found
                        }
                    } else {
                        // If it's not a creature line, just add it as is (e.g., blank lines, comments)
                        outputLines.push(line);
                    }
                } else {
                    // Add lines outside the block as is
                    outputLines.push(line);
                }
            }

            if (errors.length > 0) {
                displayError(errors.join('\n'));
            } else {
                hideError();
            }

            return outputLines.join('\n');
        }

        /**
         * Displays an error message to the user.
         * @param {string} message The error message to display.
         */
        function displayError(message) {
            const errorMessageElement = document.getElementById('errorMessage');
            errorMessageElement.textContent = message;
            errorMessageElement.classList.remove('hidden');
        }

        /**
         * Hides the error message.
         */
        function hideError() {
            const errorMessageElement = document.getElementById('errorMessage');
            errorMessageElement.classList.add('hidden');
            errorMessageElement.textContent = '';
        }

        // Event listener for the process button
        document.getElementById('processButton').addEventListener('click', () => {
            const inputEncounter = document.getElementById('inputEncounter').value;
            const outputEncounter = document.getElementById('outputEncounter');

            if (inputEncounter.trim() === '') {
                displayError("Please paste an encounter block into the input area.");
                outputEncounter.value = '';
                return;
            }

            const processedBlock = processEncounterBlock(inputEncounter);
            outputEncounter.value = processedBlock;
        });

        // Event listener for the copy button
        document.getElementById('copyButton').addEventListener('click', () => {
            const outputEncounter = document.getElementById('outputEncounter');
            const copyFeedback = document.getElementById('copyFeedback');

            if (outputEncounter.value.trim() === '') {
                displayError("Nothing to copy. Please process an encounter first.");
                return;
            }

            outputEncounter.select();
            outputEncounter.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                copyFeedback.textContent = 'Copied to clipboard!';
                copyFeedback.classList.add('show');
                setTimeout(() => {
                    copyFeedback.classList.remove('show');
                }, 2000); // Hide feedback after 2 seconds
            } catch (err) {
                displayError('Failed to copy. Please copy manually.');
                console.error('Failed to copy text: ', err);
            }
        });

        // Parse XML data when the script loads
        parseMonsterXML();
    </script>
</body>
</html>
